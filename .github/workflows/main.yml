# SPDX-FileCopyrightText: 2022 Free Software Foundation Europe e.V. <https://fsfe.org>
#
# SPDX-License-Identifier: CC0-1.0

name: REUSE Compliance Check

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: List Repos
        id: list_repos
        run: |
          org_name="InditexTech" # Cambiar por el nombre de la organización
          token="${{ secrets.GITHUB_TOKEN }}"
          repos=$(curl -s -H "Authorization: token $token" "https://api.github.com/orgs/$org_name/repos" | jq -r '.[].ssh_url')

          echo "::set-output name=repos::$repos"

      - name: Clone Repos and Run Actions
        run: |
          repos="${{ steps.list_repos.outputs.repos }}"
          IFS=$'\n' # Cambia el separador a salto de línea
          for repo in $repos; do
            repo_name=$(basename "$repo" ".git") # Extrae el nombre del repositorio
            echo "Cloning $repo_name"
            # Clona el repositorio utilizando actions/checkout
            # Configura las credenciales de Git para la autenticación
            git config --global credential.helper store
            # Esto asume que el repositorio es público, si necesitas autenticación, puedes proporcionar un token personal de acceso
            git clone https://$token@github.com/$org_name/$repo_name
            cd $repo_name
            echo "Running action in $repo_name"
            # Ejecuta el action en el repositorio clonado
            uses: fsfe/reuse-action@v2
            # Puedes proporcionar cualquier entrada requerida por el action, como argumentos o parámetros
            # Si el action espera alguna entrada, asegúrate de proporcionarla aquí
            # Ejemplo: with:
            #             input1: value1
            cd ..
          done
